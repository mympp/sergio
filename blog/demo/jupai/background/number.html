<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="csrf-token" content="I9VnGhpb1YFgTJPiLA7u89h73Ps15wcxGo4Lhguy" />
	<meta name="renderer" content="webkit">
	<meta name="description" content="聚派科技，国内首家移动场景营销广告平台。广告sdk流量变现联盟，ios、android广告插件sdk，新型互联网app流量变现模式；场景营销广告联盟，cpa cpm cpc cps cpt等。聚派-简单连接一切，开启智慧生活。">
	<meta name="keywords" content="流量变现、app流量变现、广告sdk、sdk广告、场景营销、cpm广告联盟、app广告联盟、广告联盟">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=IE8">
	<title>聚派-SDK-财务报表</title>
	<link rel="stylesheet" href="/css/metisMenu.min.css">
	<link rel="stylesheet" href="/background/css/dateRange.css">
	<link rel="stylesheet" href="css/index.css"></head>
<body>
	<div id="wrapper">

		<!-- 右侧 -->
		<div class="content_wrap" style="margin-left:0;">
			<div class="container chipList-container">
				<input type="hidden" id="account-type" value="4">
				<input type="hidden" name="name" value="" id="per-price">
				<div class="all-details">
					<p class="title clearfix">
						<span class="bold fl">财务报表</span>

					</p>
					<!-- 广告列表 -->
					<div class="search-box finance-searchbox clearfix">
						<span class="finance-amount fl">
							账户余额： <em id="finance-surplus">0</em>
							元
						</span>
						<span class="finance-amount fl">
							广告单价： <em id="finance-perprice">0</em>
							元
						</span>

						<!-- <span class="effective-ad fl">
						剩余广告条数： <em id="messagesOKNum">0</em>
						条
					</span>
					-->
					<span class="effective-ad fl" style="display:none;">
						本月剩余设备广告条数：
						<em id="messagesBoxNum">0</em>
						条
					</span>
					<a href="javascript:;" id="ad-search-btn" class="search-btn fr">查询</a>
					<div class="date-select-box fr">
						<input class="date-select" id="finance-search-date" placeholder="请选择日期" readonly></div>
				</div>
				<div class="finance-total">
					<div>
						<p class="finance-total-detail">
							收入总金额：
							<span id="income-all">0</span>
							元
						</p>
						<p class="finance-total-detail" style="display:none;">
							获赠设备广告总数：
							<span id="income-box">0</span>
							条
						</p>
					</div>
					<div>
						<p class="finance-total-detail">
							APP广告支出金额：
							<span id="expend-app">0</span>
							元
						</p>
						<p class="finance-total-detail" style="display:none;">
							设备广告消耗条数：
							<span id="expend-box-num">0</span>
							条
						</p>
						<p class="finance-total-detail" style="display:none;">
							设备广告消费：
							<span id="expend-box">0</span>
							元
						</p>
					</div>
				</div>
				<div class="table-responsive">
					<table class="table table-striped" id="financeCenter-table">
						<colgroup>
						<col style="width: 18.42%;">
						<col style="width: 13.68%;">
						<col style="width: 36.94%;">
						<col style="width: 15.39%;">
						<col style="width: 15.57%;"></colgroup>
					<thead>
						<tr>
							<th>日期</th>
							<th>交易类型</th>
							<th>交易内容</th>
							<th>费用</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody id="financeList-data"></tbody>
				</table>
			</div>
			<div class="page-show clearfix">
				<span class="page-count fl">每页显示15条</span>
				<span class="page-count fl" id="datacount"></span>
				<div id="finance-pagination">
					<div id="datajsonnext">下一页</div>
				</div>
			</div>
			<div class="recharge-box" id="detail-box">
				<div class="recharge-mask"></div>
				<div class="recharge-content" id="detail-content">
					<h3 class="title">查看详情</h3>
					<div class="detail-con"></div>
					<div class="recharge-btns">
						<input type="hidden" id="money_balance">
						<input type="hidden" id="box_balance">
						<input type="hidden" id="advert_price">
						<a href="javascript:;" class="recharge-cancel" style="width: 100%;">确定</a>
					</div>
				</div>
			</div>
		</div>
	</div>

</div>
</div>
<div class="loading-area">
<div class="loading-mask"></div>
<div class="loading-icon"></div>
</div>
<!--[if !IE]>
-->
<script src="/js/jquery-2.1.4.min.js"></script>
<!-- <![endif]-->
<!--[if IE]>
<script src="/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script src="/background/js/metisMenu.js"></script>
<script>
		$(function() {
			 $('#menu').metisMenu({
				toggle: false
			});
		});
	</script>
<script type="text/javascript">
	$(document).ready(function(){
		$(".post_content a[href='"+window.location.href+"']").addClass("selflink")
		$('.selflink').click(function() {return false;});
		$.fn.scrollFollow=function(options){options=options||{};options.container=options.container||$(this).parent();options.bottomObj=options.bottomObj||'';options.bottomMargin=options.bottomMargin||0;options.marginTop=options.marginTop||0;options.marginBottom=options.marginBottom||0;$window=$(window),$scrollObj=$(this);if($scrollObj.length<=0){return}scrollObj_Top=$scrollObj.position().top,scrollObj_Container_Height=options.container.height(),scrollObj_Position=$scrollObj.css("position");if(options.bottomObj==''||$(options.bottomObj).length<=0){is_bottomObj_exists=false}else{is_bottomObj_exists=true}$window.scroll(function(event){var new_scrollObj_Container_Height=options.container.height();var scrollObj_Height=$scrollObj.height();if(scrollObj_Container_Height!=new_scrollObj_Container_Height&&scrollObj_Container_Height<new_scrollObj_Container_Height+scrollObj_Height){scrollObj_Top=$scrollObj.position().top;scrollObj_Container_Height=new_scrollObj_Container_Height}scrollTop=$window.scrollTop(),topPosition=Math.max(0,scrollObj_Top-scrollTop);if(is_bottomObj_exists==true){var bottomObj_Top=$(options.bottomObj).position().top-options.marginBottom-options.marginTop;topPosition=Math.min(topPosition,(bottomObj_Top-scrollTop)-scrollObj_Height)}if(scrollTop>scrollObj_Top){if(is_bottomObj_exists==true&&(scrollObj_Top+scrollObj_Height>bottomObj_Top)){$scrollObj.css({position:scrollObj_Position,top:scrollObj_Top})}else{if(window.XMLHttpRequest){$scrollObj.css({position:"fixed",top:topPosition+options.marginTop})}else{$scrollObj.css({position:"absolute",top:scrollTop+topPosition+options.marginTop+'px'})}}}else{$scrollObj.css({position:scrollObj_Position,top:scrollObj_Top})}})};
		$(".sidebar").scrollFollow({
			bottomObj: '.footer',
			marginTop: 0,
			marginBottom: 2
		});
	});
	</script>
<script src="/background/js/index.js"></script>
<script type="text/javascript" src="/js/layer.js"></script>
<script src="/background/js/dateRange.js"></script>

<script type="text/javascript">
	var BASEURL = "/";
	var ACCOUNT = "";
	var pageNo = 0;
	var pageDataCount = 15;
	$(document).ready(function() {
		$("#nav-financeCenter").addClass("open");
		// financeCenter.init();
		getfinanceDetail(getQueryParam(0));
		getfinanceBalance();
		$("#ad-search-btn").click(function(event) {
			event.preventDefault();
			pageNo = 0;
			getfinanceDetail(getQueryParam(pageNo));
		});
		$("#datajsonnext").click(function(event) {
			event.preventDefault();
			getfinanceDetail(getQueryParam(pageNo++));
		});
	});

	function getQueryParam(pageNo) {
		var params = {
			startTime: $("#ad-startDate").val(), //开始时间
			endTime: $("#ad-endDate").val(), //结束时间
			page: pageNo, //当前页码
			pageSize: pageDataCount, //每页数量
		};
		return params
	}

	function getfinanceDetail(params) {
		$.ajax({
				url: '/finance/financeDetail.do',
				type: 'POST',
				dataType: 'json',
				data: params
			})
			.done(function(data) {
				// alert(data.errCode);
				if (data.errCode == '200') {
					$("#financeCenter-table > tbody > tr").remove();
					alert(data);
					// alert($("#everyday-list-table").html());
					$("#datacount").text("共" + data.result.analysis.messageCount + "条记录")
					if (pageNo * pageDataCount <= data.result.analysis.messageCount) {
						$.each(data.result.messageList, function(i, v) {

							$("#financeCenter-table > tbody").append("<tr><td>" + v.createdate + "</td><td>" + v.money_handle_type + "</td></tr>")
						});
					} else {
						layer.alert("没有下一页");
						getfinanceDetail(getQueryParam(pageNo--));
					}
				} else {
					layer.alert(data.errMsg);
				}
			})
			.fail(function() {
				console.log("error");
			});
	}

	function getfinanceBalance(){
		// $.ajax({
		// 		url: '/finance/financeBalance.do',
		// 		type: 'POST',
		// 		dataType: 'json'
		// 	})
		// 	.done(function(data) {
		// 		// alert(data.errCode);
		// 		if (data.errCode == '200') {
		// 				$("#finance-surplus").text(data.errMsg.balance?data.errMsg.balance:0);
		// 				$("#finance-perprice").text(data.errMsg.perprice?data.errMsg.perprice:0);
		// 		} else {
		// 			layer.alert(data.errMsg);
		// 		}
		// 	})
		// 	.fail(function() {
		// 		console.log("error");
		// 	});
		 $.ajax({
                url: '/advert/sumfee.do',
                type: 'POST',
                dataType: 'json',
                data: {
                    adType: 0
                }
            })
            .done(function(data) {
                if(data.errCode=='200'){
                	var usefee=(data.remainFee-((data.sumCPC)?data.sumCPC:0)-((data.sumCPM)?data.sumCPM:0))/100;
                	$("#finance-surplus").text(usefee);
                }
            });
	}
</script>

</body>
</html>