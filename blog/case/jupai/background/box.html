<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="csrf-token" content="I9VnGhpb1YFgTJPiLA7u89h73Ps15wcxGo4Lhguy"/>
    <meta name="renderer" content="webkit">
    <meta name="description"
          content="聚派科技，国内首家移动场景营销广告平台。广告sdk流量变现联盟，ios、android广告插件sdk，新型互联网app流量变现模式；场景营销广告联盟，cpa cpm cpc cps cpt等。聚派-简单连接一切，开启智慧生活。">
    <meta name="keywords" content="流量变现、app流量变现、广告sdk、sdk广告、场景营销、cpm广告联盟、app广告联盟、广告联盟">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=IE8">
    <title>聚派-SDK-设备列表</title>

    <link rel="stylesheet" href="/css/metisMenu.min.css">
    <link type="text/css" rel="stylesheet" href="/css/tipso.min.css">
    <link rel="stylesheet" href="/css/dateRange.css">
    <link rel="stylesheet" href="/background/css/index.css">
    <link rel="stylesheet" type="text/css" href="/css/box.css">
</head>
<body>
<div id="wrapper">

    <!-- 右侧 -->
    <div class="content_wrap" style="margin-left:0;">
        <div class="container chipList-container">
            <div class="all-overview">
                <p class="title clearfix">
                    <span class="bold fl">所有客户统计概括</span>
                    <!-- <thead>
                        <tr>
                            <th align="left" width="15%">序号</th>
                            <th align="left" width="15%">客户名称</th>
                            <th align="left" width="15%">所属区域</th>
                            <th align="left" width="15%">所属行业</th>
                            <th align="left" width="40%">设备Mac</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>2</td>
                            <td>3</td>
                            <td>4</td>
                        </tr>
                    </tbody> -->
                </p>
            </div>
            <div class="all-details">
                <p class="title clearfix">
                    <span class="bold fl">个人账户统计报表</span>
                </p>
                <p class="details clearfix">
                    <span>魔盒总数：<em id="self-chipTotal"></em>个</span>
                    <span>场景总数：<em id="self-sceneTotal">0</em>个</span>
                </p>
                <!-- 广告列表 -->
                <div class="search-box child-search-box clearfix">
                    <div class="fl">
                        <input type="checkbox" id="select-all" class="regular-checkbox">
                        <label for="select-all"></label>
                        <label for="select-all">全选</label>
                        |
                        <a id="all-delete-btn">删除</a>
                        |
                        <a id="upgrade-btn" href="javascript:void(0);">远程升级</a>
                    </div>
                    <a href="javascript:;" id="child-search-btn" class="search-btn fr">查询</a>
                    <p class="search-input fr">
                        <input type="text" id="key-word" placeholder="输入搜索关键字" value="">
                        <span class="fa fa-search"></span>
                    </p>
                    <div class="child-selector dropdown-click fr" id="child-key-select" data-keytype="name">
                        <a class="dropdown-toggle">设备名称</a>
                        <div class="dropdown-content">
                            <ul class="dropdown-menu">
                                <li id="ad-all" data-keytype="name"><a>设备名称</a></li>
                                <li id="ad-all" data-keytype="phone"><a>联系电话</a></li>
                            </ul>
                            <span class="dropdown-arrow"><em></em></span>
                        </div>
                    </div>
                    <span class="text fr">关键字类型：</span>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped" id="box-table" cellspacing="0" cellpadding="0" border="0">
                        <thead>
                        <tr>
                            <th align="left" width="5%"></th>
                            <th align="left" width="12%">设备名称</th>
                            <th align="left" width="15%">设备Mac</th>
                            <th align="left" width="10%">店铺名称</th>
                            <th align="left" width="15%">联系电话</th>
                            <th align="left" width="13%">当前版本<span class="state">(最新)</span></th>
                            <th align="left" width="15%">添加日期</th>
                            <th align="left" width="15%">操作</th>
                            <!-- <th align="left" width="10%"><a href="box2.html">查看数据</a></th> -->
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        
                    <!--  <tr>
                        <td><input type="checkbox" class="regular-checkbox" id="checkbox-5315eaf24e48217b37b7351a59a397ca" token="5315eaf24e48217b37b7351a59a397ca" value=""><label for="checkbox-5315eaf24e48217b37b7351a59a397ca"></label></td>
                        <td class="overflow-td" title="344">343<span class="state">离线</span></td>
                        <td class="overflow-td" title="E4956E4FEA05">E4956E4FEA05</td>
                        <td class="overflow-td" title="34">34</td>
                        <td class="overflow-td" title="020-28171011">020-28171011</td>
                        <td class="overflow-td" title="r35">r35 <span class="state">r37</span> </td>
                        <td class="overflow-td" title="2016-11-18 04:47:51">2016-11-18 16:47:51</td>
                        <td class="td__hidden">{&quot;id&quot;:560,&quot;shopid&quot;:690,&quot;chipid&quot;:693,&quot;name&quot;:&quot;34&quot;,&quot;ssid&quot;:null,&quot;ip&quot;:&quot;112.96.248.40&quot;,&quot;address&quot;:&quot;\u5e7f\u4e1c\u7701\u5e7f\u5dde\u5e02&quot;,&quot;providers&quot;:&quot;\u8054\u901a&quot;,&quot;gw_address&quot;:&quot;192.168.1.1&quot;,&quot;gw_port&quot;:&quot;2060&quot;,&quot;gw_mac&quot;:&quot;E4956E4FEA05&quot;,&quot;last_heartbeat_time&quot;:1479461931,&quot;token&quot;:&quot;5315eaf24e48217b37b7351a59a397ca&quot;,&quot;sys_uptime&quot;:60,&quot;sys_memfree&quot;:45712,&quot;sys_load&quot;:0.25,&quot;wifidog_uptime&quot;:41,&quot;is_ad&quot;:0,&quot;is_delete&quot;:0,&quot;is_audit&quot;:0,&quot;white_list&quot;:&quot;&quot;,&quot;url_white_list&quot;:&quot;&quot;,&quot;wx_openid&quot;:null,&quot;wx_business_api&quot;:null,&quot;wx_message_post_type&quot;:0,&quot;connection_callback_api&quot;:null,&quot;cur_version&quot;:35,&quot;set_version&quot;:0,&quot;proc_r&quot;:1,&quot;proc_t&quot;:36,&quot;cli_auth&quot;:0,&quot;cli_conn&quot;:0,&quot;offline_limit&quot;:1440,&quot;upload_interval&quot;:60,&quot;ctime&quot;:1479458871,&quot;cdate&quot;:&quot;2016-11-18 17:38:51&quot;,&quot;box_type&quot;:1,&quot;wx_info&quot;:[],&quot;under_shops&quot;:{&quot;id&quot;:690,&quot;uid&quot;:389,&quot;shopname&quot;:&quot;34&quot;,&quot;province&quot;:&quot;&quot;,&quot;city&quot;:&quot;&quot;,&quot;district&quot;:&quot;&quot;,&quot;address&quot;:&quot;&quot;,&quot;phone&quot;:&quot;020-28171011&quot;,&quot;token&quot;:&quot;20ed935cae3d5959566d8e21fcf29679&quot;,&quot;wx_id&quot;:null,&quot;wx_name&quot;:null,&quot;wx_shopid&quot;:null,&quot;wx_appid&quot;:null,&quot;wx_appsecret&quot;:null,&quot;wx_secretkey&quot;:null,&quot;portal_ad_img&quot;:null,&quot;ctime&quot;:1479458871,&quot;cdate&quot;:&quot;2016-11-18 16:47:51&quot;,&quot;is_delete&quot;:0}}</td>
                        <td class="overflow-td" >
                            <span class="info-btn fa fa-info-circle" token="5315eaf24e48217b37b7351a59a397ca" data-tipso="详情" title="详情"></span>
                            <span class="scene-btn fa fa-eye" token="5315eaf24e48217b37b7351a59a397ca" data-chipNo="E4956E4FEA05" data-name="34" data-tipso="查看场景" title="查看场景"></span>
                                                        <span class="edit-btn fa fa-pencil" token="5315eaf24e48217b37b7351a59a397ca" data-tipso="编辑" title="编辑"></span>
                            <span class="delete-btn fa fa-trash" token="5315eaf24e48217b37b7351a59a397ca"  data-tipso="删除" title="删除"></span>
                                                    </td>
                    </tr>  -->
                        <!-- 此处放置列表信息 -->
                        </tbody>
                    </table>
                </div>
                <!-- 分页 -->
                <div class="page-show clearfix" id="box-page-show">
                    <span class="page-count fl">每页显示15条</span>
                    <div id="box-list-pagination" class="fr" data-page=""></div>
                </div>
                <!-- 删除弹窗 -->
                <div class="del-ad-box" id="del-child-box">
                    <div class="del-ad-mask"></div>
                    <div class="del-ad-content" id="del-child-content">
                        <h3 class="title">删除设备后将无法还原</h3>
                        <p class="tips">删除后，该设备将会失效</p>
                        <div class="del-btns">
                            <a href="javascript:;" class="del-cancel">取消</a>
                            <a href="javascript:;" class="del-confirm" id="child-del-btn">继续删除</a>
                        </div>
                    </div>
                </div>
                <!-- Upgrade Window -->
                <div class="upgrade-box" id="upgrade-box">
                    <div class="upgrade-mask"></div>
                    <div class="upgrade-content" id="upgrade-content">
                        <h3 class="title">升级设备</h3>
                        <p class="tips">升级至版本</p>
                        <p>r37</p>
                        <p style="color:#a10000;">（注：升级过程中设备不可断电）</p>
                        <div class="upgrade-btns">
                            <a href="javascript:void(0);" class="upgrade-cancel">取消</a>
                            <a href="javascript:void(0);" class="upgrade-confirm" id="upgrade-confirm-btn">升级</a>
                        </div>
                    </div>
                </div>
                <!-- Info Window -->
                <div class="info-ad-box" id="info-child-box">
                    <div class="info-ad-mask"></div>
                    <div class="info-ad-content" id="info-child-content">
                        <h3 class="title">设备信息</h3>
                        <div class="info__container" style="padding: 0 50px;"></div>
                        <div class="info-btns">
                            <a href="javascript:;" class="info-cancel">确定</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>
<div class="loading-area">
    <div class="loading-mask"></div>
    <div class="loading-icon"></div>
</div>
<!--[if !IE]> -->
<script src="/js/jquery-2.1.4.min.js"></script>
<!-- <![endif]-->
<!--[if IE]>
<script src="/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script src="/background/js/metisMenu.js"></script>
<script type="text/javascript" src="/js/layer.js"></script>
<script>
    $(function () {
        $('#menu').metisMenu({
            toggle: false
        });
        $(document).on("click", "#ad-status-select .dropdown-menu>li", function() {
            $(this).parents("#ad-status-select").attr("data-status", $(this).attr("data-status"));
        });
        $(document).on("click", ".dropdown-click:not(.disable)", function(event) {
            event.stopPropagation();
            $(this).toggleClass("opened");
        });
        $(document).on("click", function() {
            $(".dropdown-click").removeClass("opened");
        });
        $(document).on("click", ".dropdown-click .dropdown-menu>li", function() {
            $(this).parents(".dropdown-click").children(".dropdown-toggle").html($(this).text());
        });
    });
</script>
<script type="text/javascript">
    $(document).ready(function () {
        $(".post_content a[href='" + window.location.href + "']").addClass("selflink")
        $('.selflink').click(function () {
            return false;
        });
        $.fn.scrollFollow = function (options) {
            options = options || {};
            options.container = options.container || $(this).parent();
            options.bottomObj = options.bottomObj || '';
            options.bottomMargin = options.bottomMargin || 0;
            options.marginTop = options.marginTop || 0;
            options.marginBottom = options.marginBottom || 0;
            $window = $(window), $scrollObj = $(this);
            if ($scrollObj.length <= 0) {
                return
            }
            scrollObj_Top = $scrollObj.position().top, scrollObj_Container_Height = options.container.height(), scrollObj_Position = $scrollObj.css("position");
            if (options.bottomObj == '' || $(options.bottomObj).length <= 0) {
                is_bottomObj_exists = false
            } else {
                is_bottomObj_exists = true
            }
            $window.scroll(function (event) {
                var new_scrollObj_Container_Height = options.container.height();
                var scrollObj_Height = $scrollObj.height();
                if (scrollObj_Container_Height != new_scrollObj_Container_Height && scrollObj_Container_Height < new_scrollObj_Container_Height + scrollObj_Height) {
                    scrollObj_Top = $scrollObj.position().top;
                    scrollObj_Container_Height = new_scrollObj_Container_Height
                }
                scrollTop = $window.scrollTop(), topPosition = Math.max(0, scrollObj_Top - scrollTop);
                if (is_bottomObj_exists == true) {
                    var bottomObj_Top = $(options.bottomObj).position().top - options.marginBottom - options.marginTop;
                    topPosition = Math.min(topPosition, (bottomObj_Top - scrollTop) - scrollObj_Height)
                }
                if (scrollTop > scrollObj_Top) {
                    if (is_bottomObj_exists == true && (scrollObj_Top + scrollObj_Height > bottomObj_Top)) {
                        $scrollObj.css({position: scrollObj_Position, top: scrollObj_Top})
                    } else {
                        if (window.XMLHttpRequest) {
                            $scrollObj.css({position: "fixed", top: topPosition + options.marginTop})
                        } else {
                            $scrollObj.css({
                                position: "absolute",
                                top: scrollTop + topPosition + options.marginTop + 'px'
                            })
                        }
                    }
                } else {
                    $scrollObj.css({position: scrollObj_Position, top: scrollObj_Top})
                }
            })
        };
        $(".sidebar").scrollFollow({
            bottomObj: '.footer',
            marginTop: 0,
            marginBottom: 2
        });

    });
</script>



<script type="text/javascript">

    var pageNo=1;
    var pageDataCount=15;
    $(function() {
        getdatajson();
        $("#child-search-btn").click(function(event) {
            event.preventDefault();
            pageNo=1;
            getdatajson(getQueryParam(pageNo));
        });
        $("#datajsonnext").click(function(event) {
            event.preventDefault();
            getdatajson(getQueryParam(pageNo++));
        });
     

    })

    function sceneshow(mac){
            var clickdom = this;
            
            var page = layer.open({
                type: 1,
                title: '的场景',
                content: '<table class="table table-striped daydata-table" id="scenes-list-table"><colgroup><col style="width: 12%;"><col style="width: 14%;"><col style="width: 7%;"><col style="width: 12%;"><col style="width: 10%;"><col style="width: 18%;"><col style="width: 10%;"><col style="width: 10%;"></colgroup><thead><tr><th>场景名称</th><th>芯片码</th><th>场景状态</th><th>场景归属</th><th>场景类型</th><th>场景地址</th><th>采集Mac数量</th><th>操作</th></tr></thead><tbody></tbody></table>',
                area: ['80%', '80%'], //宽高
                success: function(elem) {
                    // alert(mac);
                    $.ajax({
                            url:  '/background/router/getBoxMacSceneInfo.do',
                            type: 'POST',
                            dataType: 'json',
                            data:{Mac:mac}
                        })
                        .done(function(data) {
                            console.log(data);
                            if (data.success) {
                                var scenes = data.result;
                                if (scenes.length == 0) {
                                    $(elem).find(".layui-layer-content").html('<p class="no-data" style="display: block;">暂无数据</p>');
                                    return;
                                }
                                var html = [];
                                var scenes = data.result;
                                if (scenes != null) {
                                    $("#scene-no-data").hide();
                                    $("#scene-page-show").show();
                                    for (var i = 0; i < scenes.length; i++) {
                                        if (scenes[i].is_perfect == 0) {
                                            var status = 0;
                                            var statusText = "未完善";
                                        } else {
                                            var status = 1;
                                            var statusText = "已完善";
                                        }
                                        html.push('<tr>');
                                        html.push('<td>' + (scenes[i].current_name ? scenes[i].current_name : scenes[i].initial_name) + '</td>');
                                        html.push('<td>' + (scenes[i].chip_no == undefined ? scenes[i].chip_no : scenes[i].chip_no) + '</td>');
                                        html.push('<td>' + statusText + '</td>');
                                        /*html.push('<td>' + (scenes[i].boxType==1?"无线":"有线") + '</td>');*/
                                        html.push('<td>' + scenes[i].name + '</td>');
                                        html.push('<td>' + (scenes[i].sceneName == undefined ? '—— ——' : scenes[i].sceneName) + '</td>');
                                        html.push('<td><span class="ad-icon addr-tips tipso_style" data-tipso="' + (scenes[i].addr == undefined ? "信息未完善" : scenes[i].addr) + (scenes[i].city == undefined ? "" : scenes[i].city) + '"></span>' + (scenes[i].city == undefined ? "—— ——" : scenes[i].city) + '</td>');
                                        html.push('<td>' + scenes[i].sceneNum + '</td>');
                                        if (ACCOUNT == "") {
                                            html.push('<td>');
                                            html.push('<a class="scene-detail" data-id="' + scenes[i].initial_name + '" data-name="' + (statusText == "未完善" ? scenes[i].initial_name : scenes[i].current_name) + '" data-chipId="' + scenes[i].chip_id + '" data-chipNo="' + scenes[i].chip_no + '" data-status="' + status + '"><span class="fa fa-eye"></span></a>');
                                            html.push('<a class="scene-edit" data-id="' + scenes[i].initial_name + '" data-name="' + (statusText == "未完善" ? scenes[i].initial_name : scenes[i].current_name) + '" data-chipId="' + scenes[i].chip_id + '" data-chipNo="' + scenes[i].chip_no + '" data-status="' + status + '"><span class="fa fa-pencil"></span></a>');
                                            html.push('<a class="scene-delete" data-id="' + scenes[i].initial_name + '" data-name="' + (statusText == "未完善" ? scenes[i].initial_name : scenes[i].current_name) + '" data-chipId="' + scenes[i].chip_id + '" data-chipNo="' + scenes[i].chip_no + '" data-status="' + status + '"><span class="fa fa-trash"></span></a>'); //暂不上线
                                            html.push('</td>');
                                        } else {
                                            html.push('<td>—— ——</td>');
                                        }
                                        html.push('</tr>');
                                    }
                                    $(elem).find("#scenes-list-table>tbody").html(html.join(""));
                                    scenesList.bindEvent();
                                }
                                //$(elem).find("#scenes-list-table").html(html.join(""));
                            } else {
                                $(elem).find(".layui-layer-content").html('<p class="no-data" style="display: block;">暂无数据</p>');
                            }
                        })
                        .fail(function(data) {
                            console.log("error");
                        });
                }
            });
    }

    function getQueryParam(pageNo){
        var selectKeytype = $("#child-key-select").attr("data-keytype");
            var params={
                kw: $("#key-adname").val(),//搜索关键词
                q: selectKeytype,
                
                page: pageNo,//当前页码
                pageSize: pageDataCount,//每页数量
            };
        return params 
    }

    function getdatajson(params){
        var pagi = new Pagination("#box-list-pagination"); //分页
        $.ajax({
            url: '/background/router/listRouter.do',
            type: 'POST',
            dataType: 'json',
            data:params
        })
        .done(function(data) {
            // alert(data.errCode);
            if(data.errCode=='200'){
                // alert(data);
                // alert($("#everyday-list-table").html());
                // alert(data.result.total+" "+pageNo*pageDataCount+" "+data.result.total+ "  "+ (pageNo*pageDataCount>=data.result.total));
                $("#datacount").text("共"+data.result.total+"条记录")
                if((pageNo-1) * pageDataCount <= data.result.total){
                    $("#box-table > tbody > tr").remove();
                    $.each(data.result.box,function(i,v){

                        $("#box-table > tbody").append("<tr><td><input type='checkbox' class='regular-checkbox' id='checkbox-"+v.token+ "'token='"+v.token+"' value=''><label for='checkbox-"+v.token+"'></label></td> <td class='overflow-td'>"+v.boxName+"</td><span class='state'>离线</span> <td class='overflow-td'>"+v.boxMac+"</td> <td class='overflow-td'>"+v.shopname+"</td> <td class='overflow-td'>"+v.phone+"</td> <td class='overflow-td'>"+"版本"+"</td> <td class='overflow-td'>"+v.date+"</td>           <td class='overflow-td'><span class='info-btn fa fa-info-circle' token='"+v.token+"' data-tipso='详情' title='详情'></span>"+"<span class='scene-btn fa fa-eye' token='"+v.token+"' data-chipNo='E4956E4FEA05' data-name='34' data-tipso='查看场景' title='查看场景' onclick='sceneshow(\""+v.boxMac+"\")'></span>"+"<span class='edit-btn fa fa-pencil' token='"+v.boxMac+"' data-tipso='编辑' title='编辑' onclick=\"editRouter('"+v.token+"')\" ></span>"+"<span class='delete-btn fa fa-trash' token='5315eaf24e48217b37b7351a59a397ca'  data-tipso='删除' title='删除' onclick=\"deleteRouter('"+v.token+"','"+v.boxName+"')\" ></span>"+"</td></tr>")   
                    });
                    var pageCount = Math.ceil(data.result.total / pageDataCount); //计算总页数
                    // alert("pageCount:"+pageCount)
                        $("#after-officialMessagesTotal").html(data.result.total);
                        pagi.update({
                            pageCount: pageCount,
                            pageNo: pageNo
                        });
                        //分页点击
                        var activePage = parseInt($(".pagination>.active").text());                        
                        activePage = activePage ? activePage : 1;
                        page_index = activePage;
                        $(".pagination-prev > a").click(function(){
                            if (activePage > 1) {
                                getdatajson(getQueryParam(pageNo--));
                            }else{
                                layer.alert("没有上一页");   
                            }
                        });
                         $(".pagination-next > a").click(function(){
                            // alert()
                            // if (pageCount - activePage > 0) {
                                pageNo=pageNo+1;
                                // alert(pageNo);
                                getdatajson(getQueryParam(pageNo));
                            // }else{
                                // layer.alert("没有下一页");
                            // }
                        });
                }else{
                    alert("没有下一页")
                }
            }else{
                alert(data.errMsg);
            }
        })
        .fail(function() {
            console.log("error");
        });
    }

    function editRouter2(id,status) {
        $.ajax({
            url: '/advert/advertUpdateStatus.do',
            type: 'post',
            dataType: 'json',
            data: { mid: id,status:status}
        })
        .done(function(data) {
            console.log("success");
            if(data.errCode=='200'){
                alert("成功");
            }else{
                alert(data.errMsg);
            }
        })
        .fail(function() {
            console.log("error");
        });
    }

    function editRouter(token) {
        window.location.href = "/background/boxAct.html?token=" + token;
    }

    function deleteRouter(token,boxName){
        if(confirm("名字为 : "+boxName+"的盒子")){
            $.ajax({
                url: '/background/router/deleteRouter.do',
                type: 'post',
                dataType: 'json',
                data: { token: token}
            })
            .done(function(data) {
                console.log("success");
                if(data.errCode=='200'){
                    alert("成功");
                    window.location.href='box.html';
                }else{
                    alert(data.errMsg);
                }
            })
            .fail(function() {
                console.log("error");
            });
        
        }
    }
    
    </script>
     <script src="/background/js/box.js"></script>
    <script type="text/javascript">
        var BASEURL = '/';

        var BASEINDEX = 'agentIndex';
        
        var ACCOUNT = "";
    
        var TOTAL = 51;
        var PER = 15
        var CURRENT = 1;

        $(document).ready(function() {
            $("#nav-boxList").addClass("open");

            box.init();
            // box.listBox(CURRENT);
        });
    </script>
</body>
</html>
