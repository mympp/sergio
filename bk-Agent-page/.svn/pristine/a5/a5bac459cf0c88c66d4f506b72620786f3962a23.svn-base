<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>业务员管理</title>
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/index.css">
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/common.css">
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/set.css">
</head>
<body style="min-width: 1280px;">
<!--父容器开始-->
<div class="outer_div">
	<div class="left_template">
       <include file="Common:left_nav"/>
    </div>
    <div class="right_template">
        <include file="Common:right_nav"/>
    </div>
	<div class="page-set">
		<h2>业务员设置</h2>
        <a href="javascript:;" class="addSalesman blue-btn add-btn" >新增</a>
    	<form class="agent-head border-top">
    		<p>按条件筛选：</p>
        	<div class="agent-input">
            	<label>姓名：</label><input type="text" name="searchName" placeholder="">
        		<label>账号：</label><input type="text" name="searchEmail" placeholder="">
        		<!-- <div class="fl"> -->
                    <label>状态：</label>
            		<select class="searchStatus">
            			<option value="0">启用</option>
            			<option value="1">禁用</option>
            		</select>
                <!-- </div> -->
                <!-- <div class="cb"></div> -->
            </div>
    		<input type="button" value="搜索" name="search" class="blue-btn" id="searchBtn">
    		<input type="button" value="清空" name="clear" class="white-btn">
    	</form>
		<!--表格模块开始-->
        <div class="table-wrap">
            <div class="table-head">
                <div class="table-head-wrap">
                    <table class="grid">
                        <colgroup>
                            <col style="width:10%">
                            <col style="width:10%">
                            <col style="width:20%">
                            <col style="width:10%">
                            <col style="width:20%">
                            <col style="width:10%">
                            <col style="width:20%">
                        </colgroup>
                        <thead>
							<tr>
								<th>业务员</th>
								<th>联系电话</th>
								<th>账号</th>
								<th class="suoshu">所属代理商</th>
								<th>最后登录日期</th>
								<th>状态</th>
								<th class="caozuo">操作</th>
							</tr>
						</thead>
                    </table>
                </div>
            </div>
            <div class="table-content table-content2">
                <table class="grid">
                    <colgroup>
                        <col style="width:10%">
                        <col style="width:10%">
                        <col style="width:20%">
                        <col style="width:10%">
                        <col style="width:20%">
                        <col style="width:10%">
                        <col style="width:20%">
                    </colgroup>
                    <tbody class="table_ctbody">
						<!-- <tr>
							<td>
								<a href="javascript:;" class="salesmanDetails">名称A</a>
							</td>
							<td>15612345678</td>
							<td>chenkaiwen@527so.com</td>
							<td>XX代理商</td>
							<td>2017-10-30 18：59</td>
							<td>有效</td>
							<td class="tda2">
								<a href="javascript:;" class="salesmanRedact fl">编辑</a>
								<a href="javascript:;" class="removeBtn fr">删除</a>
							</td>
						</tr> -->
                    </tbody>
                </table>
            </div>
        </div>
        <!--表格模块结束-->
        <!--分页器开始-->
        <div class="xiansuo_Page_Div">
            <!--<div class="xiansuo_Page_border"></div>-->
            <div class="xiansuo_Page_div">
                <!-- <div class="fl">
                    <span style="margin-right: 5px;">每页显示</span>
                    <select class="xiansuo_Page_Three">
                        <option value="10">10</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span style="margin-left: 5px;">条</span><span style="margin-left: 10px;">共</span><span class="xiansuo_Sizes">1500</span><span>条/</span><span class="xiansuo_Pages">50页</span>
                    <img class="first_page" title="第一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_01.png" alt="" />
                    <img class="prev_page" title="上一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_02.png" alt="" />
                </div>
                <ul class="xiansuo_Page_list">
                    <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li>
                </ul>
                <img class="next_page" title="下一页" style="margin-left: 15px;" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_03.png" alt="" />
                <img class="last_page" title="最后一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_04.png" alt="" />
                <span style="margin: 0 5px;">跳转</span><input type="text" value="0" class="that_Page" maxlength="10" /><span style="margin-left: 5px;">页</span> -->
            </div>
        </div>
        <!--分页器结束-->
        <!-- 虚拟弹窗开始 -->
        <!-- 背景 -->
        <div class="moni-box" style="display: none;"></div>
		<!-- 新增业务员 -->
		<div class="add-salesman moni-lbox" style="display: none;">
			<div class="moni-head">
				<p class="fl">新增业务员</p>
				<em class="DataCenterBox-cols cleanAll fr">&#215;</em>
			</div>
			<form class="moni-main">
				<label>姓名</label><i>：</i>
                <input type="text" name="addname" placeholder="业务员名称"><br />
				<label>电话</label><i>：</i>
                <input type="text" name="addphone" placeholder="业务员电话"><br />
				<label>账号</label><i>：</i>
                <input type="text" name="addID" placeholder="业务员账号"><br />
				<label>密码</label><i>：</i>
                <input type="password" name="addpassword"><br />
				<label>启动状态</label><i>：</i>
				<select class="addStatus">
					<option value="0">有效</option>
					<option value="1">无效</option>
				</select>
				<div class="btn-box">
                    <input type="button" name="submit" value="确认" class="submit blue-btn" id="addSalesmanSub">
					<input type="button" name="cancel" value="取消" class="cancel white-btn">
				</div>
			</form>
		</div>
		<!-- 业务员详情 -->
		<div class="salesman-details moni-lbox" style="display: none;">
			<div class="moni-head">
				<p class="fl">业务员详情</p>
				<em class="DataCenterBox-cols cleanAll fr">&#215;</em>
			</div>
			<div class="moni-main">
				<label>姓名</label><i>：</i>
				<span class="name"></span><br />
				<label>账号</label><i>：</i>
				<span class="ID"></span><br />
				<label>电话号码</label><i>：</i>
				<span class="phone"></span><br />
				<label>状态</label><i>：</i>
				<span class="status"></span><br />
				<label>创建日期</label><i>：</i>
				<span class="addTime"></span><br />
				<label>更新日期</label><i>：</i>
				<span class="updateTime"></span><br />
			</div>
		</div>
		<!-- 编辑业务员 -->
		<div class="salesman-redact moni-lbox" style="display: none;">
			<div class="moni-head">
				<p class="fl">编辑业务员</p>
				<em class="DataCenterBox-cols cleanAll fr">&#215;</em>
			</div>
			<form class="moni-main">
				<label>姓名</label><i>：</i>
                <input type="text" name="name"><br />
				<label>电话</label><i>：</i>
                <input type="text" name="phone"><br />
				<label>账号</label><i>：</i>
                <input type="text" name="ID"><br />
				<label>密码</label><i>：</i>
                <input type="password" name="password"><br />
				<label>启动状态</label><i>：</i>
				<select class="salesRedactStatus">
					<option value="有效">有效</option>
					<option value="无效">无效</option>
				</select><br />
				<label>创建日期</label><i>：</i>
                <span class="addTime"></span><br />
				<label>更新日期</label><i>：</i>
                <span class="updateTime"></span><br />
				<div class="btn-box">
                    <input type="hidden" name="salesman_upd_Id" value="">
                    <input type="button" name="submit" value="确认" class="submit blue-btn" id="salesmanRedactSub">
					<input type="button" name="cancel" value="取消" class="cancel white-btn">
				</div>
			</form>
		</div>
        <!-- 删除按钮 -->
        <div class="remove-box moni-lbox" style="display: none;">
            <p>确认删除？</p>
            <div class="btn-box">
                <input type="button" value="确认" name="remove" class="removeSubmit blue-btn">
                <input type="button" value="取消" name="cancel" class="cancel white-btn">
            </div>
        </div>
		<!-- 虚拟弹窗结束 -->
	</div>
</div>
<script>var pages = "角色管理";var index1 = 3; var index2 = 3;</script>
<script src="STYLE_DOMAIN/Agent/js/jquery.js"></script>
<script src="STYLE_DOMAIN/Agent/js/common.js"></script>
<script src="STYLE_DOMAIN/Agent/js/role-agent.js"></script>
<script type="text/javascript">
    var noDataHtml = `
        <div class="no-data-box">
            <img src="STYLE_DOMAIN/Agent/Images/common_icon_Nodata_nor.png" width="102px" height="80px">
            <p>查询不到数据</p>
        </div>
    `;
    var salesman = "{:U('Role/salesman_list')}";
    var salesman_details = "{:U('Role/salesman_details')}";
    var add_salesman = "{:U('Role/add_salesman')}";
    var del_salesman = "{:U('Role/del_salesman')}";
    var upd_salesman= "{:U('Role/upd_salesman')}";
    $(function(){
        LoadDownFn();
    })
    function LoadDownFn(page,size,name,user,sta){
        $('.table_ctbody').empty();
        $('.xiansuo_Page_div').empty();
        $.post(salesman,{'page':page,'size':size,'name':name,'user':user,'sta':sta},function(data){
            var reult = '';
            if(data.code != 1){
                alert(data.message);
                return;
            }else{
                var length = data.data.length;
                if(length == 0){
                    $(".table_ctbody").append(noDataHtml);
                    return;
                }
                if(data.is_admin == 1){
                    $('.addSalesman').attr('style','display:none');
                    $('.caozuo').remove();
                    for(var i=0;i<length;i++){
                        reult +=
                        '<tr>'+
                            '<input type="hidden" name="salesmanId" value="'+data.data[i].m_user_id+'">'+
                            '<td>'+
                                '<a href="javascript:;" class="salesmanDetails">'+data.data[i].m_user_name+'</a>'+
                            '</td>'+
                            '<td>'+data.data[i].m_user_tel+'</td>'+
                            '<td>'+data.data[i].m_user_account+'</td>'+
                            '<td>'+data.data[i].agentName+'</td>'+
                            '<td>'+data.data[i].m_user_udatetime+'</td>'+
                            '<td>'+data.data[i].m_user_void_flag+'</td>'+
                        '</tr>';
                    }
                }else if(data.is_admin == 2){
                    $('.suoshu').remove();
                    for(var i=0;i<length;i++){
                        reult +=
                        '<tr>'+
                            '<input type="hidden" name="salesmanId" value="'+data.data[i].m_user_id+'">'+
                            '<td>'+
                                '<a href="javascript:;" class="salesmanDetails">'+data.data[i].m_user_name+'</a>'+
                            '</td>'+
                            '<td>'+data.data[i].m_user_tel+'</td>'+
                            '<td>'+data.data[i].m_user_account+'</td>'+
                            '<td>'+data.data[i].m_user_udatetime+'</td>'+
                            '<td>'+data.data[i].m_user_void_flag+'</td>'+
                            '<td class="tda2">'+
                                '<a href="javascript:;" class="salesmanRedact fl">编辑</a>'+
                                '<a href="javascript:;" class="removeBtn fr">删除</a>'+
                            '</td>'+
                        '</tr>';
                    }
                }
                $('.table_ctbody').append(reult);
                $('.xiansuo_Page_div').append(data.page);
            }
        },'json');
    }
    //为分页器每个li绑定单击事件
    $(document).on("click",".xiansuo_Page_list li",function(){
        var index = $(this).index();
        var page = $(this).html();
        $(this).addClass("active").siblings().removeClass("active");
        $(".that_Page").val(page);              
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        var status = '';  
        if(name != '' || user!=''){
            var status = $(".searchStatus:visible").val();      
        }
        LoadDownFn(page,page_size,name,user,status);  
    })

    //为跳转至输入框监听键盘事件
    $(document).on("keydown",".that_Page",function(e){
        var page = $(this).val();
        var num = $('#xiansuo_pages_count').html();
        if(page>num){
            page=1;
        }               
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        if(e.keyCode==13){
            LoadDownFn(page,page_size,name,user);            
        }
    })

    //为首页判定事件
    $(document).on('click','.first_page',function(e){
        var page = 1;               
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        var status = '';  
        if(name != '' || user!=''){
            var status = $(".searchStatus:visible").val();      
        }
        LoadDownFn(page,page_size,name,user,status);
        e.stopPropagation();
    })

    //为上一页绑定事件
    $(document).on('click','.prev_page',function(e){
        var page = $(this).attr('name');                
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        var status = '';  
        if(name != '' || user!=''){
            var status = $(".searchStatus:visible").val();      
        }
        LoadDownFn(page,page_size,name,user,status);
        e.stopPropagation();
    })

    //为下一页绑定事件
    $(document).on('click','.next_page',function(e){
        var page = $(this).attr('name');            
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        var status = '';  
        if(name != '' || user!=''){
            var status = $(".searchStatus:visible").val();      
        }
        LoadDownFn(page,page_size,name,user,status);
        e.stopPropagation();
    })

    //为尾页绑定事件
    $(document).on('click','.last_page',function(e){
        var page = $(this).attr('name');                
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $("input[name=searchName]").val();
        var user = $("input[name=searchEmail]").val(); 
        var status = '';  
        if(name != '' || user!=''){
            var status = $(".searchStatus:visible").val();      
        }
        LoadDownFn(page,page_size,name,user,status);
        e.stopPropagation();
    })

    //后台提交
    //搜索按钮
    $(document).on("click","#searchBtn",function(){
        var searchName = $("input[name=searchName]").val(),
        searchEmail = $("input[name=searchEmail]").val(),
        status = $(".searchStatus:visible").val();
        if (searchName == "" && searchEmail == "") {
            alert("搜索项不能为空");
        } else {
            var page = 1;
            var page_size= $('.xiansuo_Page_Three').val();
            LoadDownFn(page,page_size,searchName,searchEmail,status);
        }
    });
    $("input[name=clear]").click(function(){
        $("input[name=searchName],input[name=searchEmail]").val("");
        LoadDownFn(1,10);
    })

    //新增业务员
    $(document).on("click","#addSalesmanSub",function(){
        var name = $("input[name=addname]:visible").val(),
        phone = $("input[name=addphone]:visible").val(),
        ID = $("input[name=addID]:visible").val(),
        password = $("input[name=addpassword]:visible").val(),
        status = $(".addStatus").val();
        var numreg = /^1(3|4|5|7|8)\d{9}$/;
        if (name == "" || phone == "" || ID == "" || password == "") {
            alert("选项不能为空");
        } else if(!numreg.test(phone)){
            alert("请输入正确的电话号码");
        } else {
            var data={'name':name,'phone':phone,'user':ID,'pwd':password,'sta':status};
            $.post(add_salesman,data,function(data){
                if(data.code != 1){
                    alert(data.message);
                }else{
                    alert(data.message);
                    $(".add-salesman,.moni-box").fadeOut();
                }
            },'json');
        };
    });

    //业务员详情
    $(document).on("click",".salesmanDetails",function(){
        var id = $(this).parents('tr').find("input[name=salesmanId]").val();
        $.post(salesman_details,{'id':id},function(data){
            if(data.code != 1){
                alert(data.message);
                return;
            }
            $(".name").text(data.data.m_user_name);
            $(".phone").text(data.data.m_user_tel);
            $(".ID").text(data.data.m_user_account);
            $(".status").text(data.data.m_user_void_flag);
            $(".addTime").text(data.data.m_user_rdatetime);
            $(".updateTime").text(data.data.m_user_udatetime);
        },'json');
        $(".salesman-details,.moni-box").fadeIn();
    })


    //编辑业务员
    $(document).on("click",".salesmanRedact",function(){
        var id = $(this).parents('tr').find("input[name=salesmanId]").val();
        $.post(salesman_details,{'id':id},function(data){
            if(data.code != 1){
                alert(data.message);
                return;
            }
            //弹出虚拟窗
            $(".agent-redact,.moni-box").fadeIn();
            $("input[name=salesman_upd_Id]").val(data.data.m_user_id);
            $("input[name=name]:visible").val(data.data.m_user_name);
            $("input[name=phone]:visible").val(data.data.m_user_tel);
            $("input[name=ID]:visible").val(data.data.m_user_account);
            $(".salesRedactStatus").val(data.data.m_user_void_flag);
            $(".addTime").text(data.data.m_user_rdatetime);
            $(".updateTime").text(data.data.m_user_udatetime);
        },'json');
        
    });

    //提交修改
    $(document).on("click","#salesmanRedactSub",function(){
        var name = $("input[name=name]:visible").val(),
        phone = $("input[name=phone]:visible").val(),
        ID = $("input[name=ID]:visible").val(),
        password = $("input[name=password]:visible").val(),
        status = $(".salesRedactStatus").val();
        var id = $("input[name=salesman_upd_Id]").val();;
        numreg = /^1(3|4|5|7|8)\d{9}$/;
        if (name == "" || phone == "" || ID == "" ) {
            alert("选项不能为空");
        } else if(!numreg.test(phone)){
            alert("请输入正确的电话号码");
        } else {
            var data = {'id':id,'name':name,'phone':phone,'user':ID,'pwd':password,'sta':status};
            $.post(upd_salesman,data,function(data){
                if(data.code != 1){
                    alert(data.message);
                }else{
                    alert(data.message);
                    $(".salesman-redact,.moni-box").fadeOut();
                }
            },'json');
        };
    });

    //删除业务员
    // 删除按钮
    $(document).on("click",".removeBtn",function(){
        var id = $(this).parents('tr').find("input[name=salesmanId]").val();
        $(this).parents("tr").addClass("remove");
        $(".remove-box,.moni-box").fadeIn();
        $(document).on("click",".removeSubmit",function(){
            $.post(del_salesman,{'id':id},function(data){
                if(data.code != 1){
                    alert(data.message);
                }else{
                    alert(data.message);
                    $(".remove").remove(); 
                    $(".remove-box,.moni-box").fadeOut();
                }
            },'json')
        })
    })
</script>
</body>
</html>