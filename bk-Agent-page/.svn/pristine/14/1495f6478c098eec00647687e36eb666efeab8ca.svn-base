<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<title>审核代理商</title>
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/index.css">
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/common.css">
	<link rel="stylesheet" type="text/css" href="STYLE_DOMAIN/Agent/css/set.css">
</head>
<body style="min-width: 1280px;">
<!--父容器开始-->
<div class="outer_div">
	<div class="left_template">
       <include file="Common:left_nav"/>
    </div>
    <div class="right_template">
    <include file="Common:right_nav"/>
    </div>
	<div class="page-set">
		<h2>审核代理商</h2>
			<form class="agent-head border-bottom">
				<p>按条件筛选：</p>
                <div class="agent-input">
    				<label>姓名：</label><input type="text" name="searchName" class="checksearchName" placeholder="">
    				<label>账号：</label><input type="text" name="searchEmail" class="checksearchEmail" placeholder="">
    				<label>状态：</label>
    				<select class="searchStatus">
    					<option value="0">待审核</option>
    					<option value="1">审核通过</option>
                        <option value="2">审核不通过</option>
    				</select>
    				<label>级别：</label>
    				<select class="rank">
    					<option value="1">一级代理</option>
    					<option value="2">二级代理</option>
    				</select>
                </div>
				<input type="button" value="搜索" name="search" class="blue-btn" id="searchBtn">
				<input type="button" value="清空" name="clear" class="white-btn clear_sousuo">
			</form>
        <!--表格模块开始-->
        <div class="table-wrap">
            <div class="table-head">
                <div class="table-head-wrap">
                    <table class="grid">
                        <colgroup>
                            <col style="width:10%">
                            <col style="width:12%">
                            <col style="width:20%">
                            <col style="width:10%">
                            <col style="width:8%">
                            <col style="width:15%">
                            <col style="width:10%">
                            <col style="width:15%">
                        </colgroup>
                        <thead>
							<tr>
								<th>代理商名称</th>
								<th>联系电话</th>
								<th>账号</th>
								<th>代理商所在区域</th>
								<th>状态</th>
								<th>专属推荐码</th>
								<th>级别</th>
								<th>操作</th>
							</tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="table-content table-content3">
                <table class="grid">
                    <colgroup>
                        <col style="width:10%">
                        <col style="width:12%">
                        <col style="width:20%">
                        <col style="width:10%">
                        <col style="width:8%">
                        <col style="width:15%">
                        <col style="width:10%">
                        <col style="width:15%">
                    </colgroup>
                    <tbody class="table_ctbody">
						<!-- <tr>
							<td>陈凯文</td>
							<td>15612345678</td>
							<td>chenkaiwen@527so.com</td>
							<td>广东广州天河</td>
							<td>通过</td>
							<td>YSSLDKGAJ123123</td>
							<td>一级代理</td>
							<td class="tda3">
								<a href="javascript:;" class="adminDetails fl">查看</a>
								<a href="javascript:;" class="passAgent">通过</a>
								<a href="javascript:;" class="nopassAgent fr">拒绝</a>
							</td>
						</tr> -->
                    </tbody>
                </table>
            </div>
        </div>
        <!--表格模块结束-->
        <!--分页器开始-->
        <div class="xiansuo_Page_Div">
            <!--<div class="xiansuo_Page_border"></div>-->
            <div class="xiansuo_Page_div">
                <!-- <div class="fl">
                    <span style="margin-right: 5px;">每页显示</span>
                    <select class="xiansuo_Page_Three">
                        <option value="10">10</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span style="margin-left: 5px;">条</span><span style="margin-left: 10px;">共</span><span class="xiansuo_Sizes">1500</span><span>条/</span><span class="xiansuo_Pages">50页</span>
                    <img class="first_page" title="第一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_01.png" alt="" />
                    <img class="prev_page" title="上一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_02.png" alt="" />
                </div>
                <ul class="xiansuo_Page_list">
                    <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li>
                </ul>
                <img class="next_page" title="下一页" style="margin-left: 15px;" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_03.png" alt="" />
                <img class="last_page" title="最后一页" src="STYLE_DOMAIN/Agent/Images/icon_sanjiao_04.png" alt="" />
                <span style="margin: 0 5px;">跳转</span><input type="text" value="0" class="that_Page" maxlength="10" /><span style="margin-left: 5px;">页</span> -->
            </div>
        </div>
        <!--分页器结束-->
		<!-- 虚拟弹窗开始 -->
        <!-- 背景 -->
        <div class="moni-box" style="display: none;"></div>
		<!-- 代理商详情 -->
		<div class="admin-details moni-lbox" style="display: none;">
			<div class="moni-head">
				<p class="fl">代理商详情</p>
				<em class="DataCenterBox-cols cleanAll fr">&#215;</em>
			</div>
			<div class="moni-main">
				<label>姓名</label><i>：</i>
				<span class="name">姓名A</span><br />
				<label>账号</label><i>：</i>
				<span class="ID">chengaiwen@527so.com</span><br />
				<label>电话号码</label><i>：</i>
				<span class="phone">15612345678</span><br />
				<label>区域</label><i>：</i>
				<span class="area">广东广州天河</span><br />
				<label>详细地址</label><i>：</i>
				<span class="address">大观中路95号407-408</span><br />
				<label>状态</label><i>：</i>
				<span class="status">启用</span><br />
				<label>推荐码</label><i>：</i>
				<span class="referralCode">YGSGE110010</span><br />
				<label>银行账号</label><i>：</i>
				<span class="bankName">中国银行</span><br />
				<label>&nbsp;</label><i>&nbsp;</i>
				<span class="bankCode">6223458974586541235</span><br />
				<label>&nbsp;</label><i>&nbsp;</i>
				<span class="peopleName">XXX公司</span><br />
				<label class="vit-top">企业资质</label><i class="vit-top">：</i>
				<span class="file1"><img src="STYLE_DOMAIN/Agent/Images/file0.png" class="big-img"><img src="STYLE_DOMAIN/Agent/Images/file0.png" class="bbig-img" style="display: none;"><a href="javascript:;">点击图片查看大图</a></span><br />
				<label>备注</label><i>：</i>
				<span class="tips">无</span><br />
				<label>创建日期</label><i>：</i>
                <span class="addTime">2017-10-30 11：48</span><br />
				<label>更新日期</label><i>：</i>
                <span class="updateTime">2017-10-30 18：48</span><br />
			</div>
		</div>
		<!-- 审核通过 -->
        <div class="passAgent-box moni-lbox" style="display: none;">
            <p>审核通过？</p>
            <div class="btn-box">
                <input type="button" value="确认" class="blue-btn" id="passAgent">
                <input type="button" value="取消" name="cancel" class="cancel white-btn">
            </div>
        </div>
		<!-- 拒绝通过 -->
        <div class="nopassAgent-box moni-lbox" style="display: none;">
            <p>拒绝通过？</p>
            <div class="btn-box">
                <input type="button" value="确认" class="blue-btn" id="noAgent">
                <input type="button" value="取消" name="cancel" class="cancel white-btn">
            </div>
        </div>
		<!-- 虚拟弹窗结束 -->
	</div>
</div>
<script>var pages = "角色管理";var index1 = 3; var index2 = 2;</script>
<script src="STYLE_DOMAIN/Agent/js/jquery.js"></script>
<script src="STYLE_DOMAIN/Agent/js/common.js"></script>
<script src="STYLE_DOMAIN/Agent/js/role-agent.js"></script>
<script type="text/javascript">
    var noDataHtml = `
        <div class="no-data-box">
            <img src="STYLE_DOMAIN/Agent/Images/common_icon_Nodata_nor.png" width="102px" height="80px">
            <p>查询不到数据</p>
        </div>
    `;
    var check_agent_list = "{:U('Role/check_agent_list')}";
    var check_agent_details = "{:U('Role/check_agent_details')}";
    var adopt_agent = "{:U('Role/adopt_agent')}";
    var refuse_agent = "{:U('Role/refuse_agent')}";
    $(function(){
       LoadDownFnCheck();
    })
    function LoadDownFnCheck(page,size,name,user,sta,leve){
        $('.table_ctbody').empty();
        $('.xiansuo_Page_div').empty();
        $.post(check_agent_list,{'page':page,'size':size,'name':name,'user':user,'sta':sta,'leve':leve},function(data){
            console.log(data);
            var reult = '';
            if(data.code != 1){
                alert(data.message);
                return;
            }else{
                var length = data.data.length;
                if(length == 0){
                     $(".table_ctbody").append(noDataHtml);
                    return;
                }
                for(var i=0;i<length;i++){
                    reult +=
                    '<tr>'+
                        '<input type="hidden" name="agentId" value="'+data.data[i].m_agent_id+'">'+
                        '<td>'+data.data[i].m_agent_company+'</td>'+
                        '<td>'+data.data[i].m_agent_tel+'</td>'+
                        '<td>'+data.data[i].m_user_account+'</td>'+
                        '<td>'+data.data[i].m_agent_areaid+'</td>';
                        if(data.data[i].m_agent_status == 0){
                            reult +=
                            '<td>待审核</td>';
                        }else if(data.data[i].m_agent_status == 1){
                            reult +=
                            '<td>审核通过</td>';
                        }else{
                            reult +=
                            '<td>审核不通过</td>';
                        }
                        reult +=
                        '<td>'+data.data[i].m_user_code+'</td>';
                        if(data.data[i].m_agent_level == 1){
                            reult +=
                            '<td>一级代理</td>';
                        }else{
                            reult +=
                            '<td>二级代理</td>';
                        }
                        reult +=
                        '<td class="tda3">';
                        if(data.data[i].m_agent_status == 1){
                            reult +=
                            '<a href="javascript:;" class="adminDetails fl">查看</a>'+
                            '<a style="color:#898989">已通过</a>'+
                            '<a href="javascript:;" class="nopassAgent fr">拒绝</a>';
                        }else if(data.data[i].m_agent_status == 2){
                            reult +=
                            '<a href="javascript:;" class="adminDetails fl">查看</a>'+
                            '<a href="javascript:;" class="passAgent">通过</a>'+
                            '<a style="color:#898989" class="fr">已拒绝</a>';
                        }else{
                            reult +=
                            '<a href="javascript:;" class="adminDetails fl">查看</a>'+
                            '<a href="javascript:;" class="passAgent">通过</a>'+
                            '<a href="javascript:;" class="nopassAgent fr">拒绝</a>';
                        }
                        reult +=
                        '</td>'+
                    '</tr>';
                }
                $('.table_ctbody').append(reult);
                $('.xiansuo_Page_div').append(data.page);
            }
        },'json');
    }

    //为分页器每个li绑定单击事件
    $(document).on("click",".xiansuo_Page_list li",function(){
        var index = $(this).index();
        var page = $(this).html();
        $(this).addClass("active").siblings().removeClass("active");
        $(".that_Page").val(page);              
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        LoadDownFnCheck(page,page_size,name,user,status,leve);  
    })

    //为跳转至输入框监听键盘事件
    $(document).on("keydown",".that_Page",function(e){
        var page = $(this).val();
        var num = $('#xiansuo_pages_count').html();
        if(page>num){
            page=1;
        }               
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        if(e.keyCode==13){
            LoadDownFnCheck(page,page_size,name,user,status,leve);     
        }
    })

    //为首页判定事件
    $(document).on('click','.first_page',function(e){
        var page = 1;               
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        LoadDownFnCheck(page,page_size,name,user,status,leve);  
        e.stopPropagation();
    })

    //为上一页绑定事件
    $(document).on('click','.prev_page',function(e){
        var page = $(this).attr('name');                
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        LoadDownFnCheck(page,page_size,name,user,status,leve);  
        e.stopPropagation();
    })

    //为下一页绑定事件
    $(document).on('click','.next_page',function(e){
        var page = $(this).attr('name');            
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        LoadDownFnCheck(page,page_size,name,user,status,leve);  
        e.stopPropagation();
    })

    //为尾页绑定事件
    $(document).on('click','.last_page',function(e){
        var page = $(this).attr('name');                
        var page_size= $('.xiansuo_Page_Three').val();
        var name = $(".checksearchName").val();
        var user = $(".checksearchEmail").val(); 
        var status = '';  
        var leve = ''
        if(name != '' || user!=''){
            status = $(".searchStatus:visible").val();  
            leve = $('.rank').val();
        }
        LoadDownFnCheck(page,page_size,name,user,status,leve);  
        e.stopPropagation();
    })

    //后台提交
    //搜索按钮
    $(document).on("click","#searchBtn",function(){
        var searchName = $(".checksearchName").val(),
        searchEmail = $(".checksearchEmail").val(),
        status = $(".searchStatus:visible").val(),
        leve = $(".rank:visible").val(),
        emailreg = /^[a-z0-9-_.]+@[\da-z][\.\w-]+\.[a-z]{2,4}$/i;
        if (searchName == "" && searchEmail == "") {
            alert("搜索项不能为空");
        } else {
            var page = 1;
            var page_size= $('.xiansuo_Page_Three').val();
            LoadDownFnCheck(page,page_size,searchName,searchEmail,status,leve);
        }
    });
    $(".clear_sousuo").click(function(){
        $(".checksearchName,.checksearchEmail").val("");
        LoadDownFnCheck(1,10);
    })
    //审核详情
    $(document).on("click",".adminDetails",function(){
        var id = $(this).parents('tr').find('input[name=agentId]').val();
        $.post(check_agent_details,{'id':id},function(data){
            data.data.m_user_void_flag = data.data.m_user_void_flag==0?"启用":'禁用';
            data.data.m_agent_address = data.data.m_agent_address?data.data.m_agent_address:'暂无';
            data.data.m_agent_bankname = data.data.m_agent_bankname?data.data.m_agent_bankname:'暂无';
            data.data.m_agent_accountno = data.data.m_agent_accountno?data.data.m_agent_accountno:'暂无';
            data.data.m_agent_accountname = data.data.m_agent_accountname?data.data.m_agent_accountname:'暂无';
            $(".name").text(data.data.m_agent_company);
            $(".phone").text(data.data.m_agent_tel);
            $(".ID").text(data.data.m_user_account);
            $(".area").text(data.data.m_agent_areaid);
            $(".address").text(data.data.m_agent_address);
            $(".status").text(data.data.m_user_void_flag);
            $(".referralCode").text(data.data.m_user_code);
            $(".file1 img").attr("src",data.data.m_agent_business_licence);
            $(".bankName").text(data.data.m_agent_bankname);
            $(".bankCode").text(data.data.m_agent_accountno);
            $(".peopleName").text(data.data.m_agent_accountname);
            $(".tips").text(data.data.m_agent_memo);
            $(".addTime").text(data.data.m_agent_createtime);
            $(".updateTime").text(data.data.m_agent_updatetime);
            $(".admin-details,.moni-box").fadeIn();
        },'json');
    })


    $(document).on("click",".passAgent",function(){
        that1 = $(this);
        $(".passAgent-box,.moni-box").fadeIn();
    })
    $(document).on("click","#passAgent",function(){
        $(that1).addClass("passbox");
        $(that1).next().addClass("refuse");
        var id = $(that1).parents('tr').find('input[name=agentId]').val();
        $(".passAgent-box,.moni-box").fadeOut();
        $.post(adopt_agent,{'id':id},function(data){
                $(".passAgent-box").fadeOut();
                if(data.code == 1){
                    $(".passbox").replaceWith("<a style='color:#898989'>已通过</a>");
                    $(".refuse").replaceWith('<a href="javascript:;" class="nopassAgent fr">拒绝</a>');
                }else{
                    alert(data.message);
                }
            },'json');
    })

    // //拒绝代理商
    $(document).on("click",".nopassAgent",function(){
        that2 = $(this);
        $(".nopassAgent-box,.moni-box").fadeIn();
    })
    $(document).on("click","#noAgent",function(){
        $(that2).addClass("nopassbox");
        $(that2).prev().addClass("adopt");
        var id = $(that2).parents('tr').find('input[name=agentId]').val();
        $(".nopassAgent-box,.moni-box").fadeOut();
        $.post(refuse_agent,{'id':id},function(data){
                $(".nopassAgent-box").fadeOut();
                if(data.code == 1){
                    $(".nopassbox").replaceWith('<a style="color:#898989" class="fr">已拒绝</a>');
                    $(".adopt").replaceWith('<a href="javascript:;" class="passAgent">通过</a>');
                }else{
                    alert(data.message);
                }
        },'json');
    })


    // //通过代理商
    // $(document).on("click",".passAgent",function(){
    //     $(this).addClass("passbox");
    //     $(this).next().addClass("refuse");
    //     var id = $(this).parents('tr').find('input[name=agentId]').val();
    //     $(".passAgent-box").fadeIn();
    //     $(document).on("click","#passAgent",function(){
    //         $.post(adopt_agent,{'id':id},function(data){
    //             $(".passAgent-box").fadeOut();
    //             if(data.code == 1){
    //                 $(".passbox").replaceWith("<a style='color:#898989'>已通过</a>");
    //                 $(".refuse").replaceWith('<a href="javascript:;" class="nopassAgent fr">拒绝</a>');
    //             }else{
    //                 alert(data.message);
    //             }
    //         },'json');
    //     })
    // })
    // // //拒绝代理商
    // $(document).on("click",".nopassAgent",function(){
    //     $(this).addClass("nopassbox");
    //     $(this).prev().addClass("adopt");
    //     var id = $(this).parents('tr').find('input[name=agentId]').val();
    //     $(".nopassAgent-box").fadeIn();
    //     $(document).on("click","#noAgent",function(){
    //         $.post(refuse_agent,{'id':id},function(data){
    //             $(".nopassAgent-box").fadeOut();
    //             if(data.code == 1){
    //                 $(".nopassbox").replaceWith('<a style="color:#898989" class="fr">已拒绝</a>');
    //                 $(".adopt").replaceWith('<a href="javascript:;" class="passAgent">通过</a>');
    //             }else{
    //                 alert(data.message);
    //             }
    //         },'json')
    //     });
    // })
</script>
</body>
</html>